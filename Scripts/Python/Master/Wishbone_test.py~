import wishbone
import os
import pandas as pd
import numpy as np
import matplotlib
import matplotlib.pyplot as plt
import seaborn as sns
import random
import pickle
import csv
scdata = wishbone.wb.SCData.from_fcs(os.path.expanduser('/opt/python3.5/lib/python3.5/site-packages/wishbone/data/sample_masscyt.fcs'), cofactor=None)
scdata.run_diffusion_map()
start_cell = scdata.data.index[(scdata.data['CD4'] < 1) & (scdata.data['CD8'] < 1)][0]
waypoints = pd.DataFrame.from_csv(os.path.expanduser('/opt/python3.5/lib/python3.5/site-packages/wishbone/data/masscyt_waypoints.csv')).iloc[:, 0]
waypoints = list(waypoints)
wb = wishbone.wb.Wishbone(scdata)
wb.run_wishbone(start_cell, components_list=[1, 2, 3], num_waypoints=waypoints)
branch = pd.Series.to_frame(wb.branch)
writebranch = "/home/developer/Data/Wishbone/branch.csv"
writebranch_colors = "/home/developer/Data/Wishbone/branch_colors.csv"
writetrajectory = "/home/developer/Data/Wishbone/trajectory.csv"
writewaypoints = "/home/developer/Data/Wishbone/waypoints.csv"
branch.to_csv(writebranch)
with open(writebranch_colors, 'w') as f:
	w = csv.DictWriter(f,wb.branch_colors.keys())
	w.writeheader()
	w.writerow(wb.branch_colors)
	f.close()
trajectory = pd.Series.to_frame(wb.trajectory)
trajectory.to_csv(writetrajectory)
a = np.asarray(wb.waypoints)
np.savetxt(writewaypoints, a, delimiter=",")




